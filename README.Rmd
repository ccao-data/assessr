---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# assessr

A package to manage, distribute, and version control commonly-used
CCAO assessment functions.

## Installation

You can install the released version of assessR directly from GitLab by running the following R command after installing `remotes`:

```{r, eval=FALSE}
remotes::install_git("https://gitlab.com/ccao-data-science---modeling/packages/assessr")
```

Once it is installed, you can use it just like any other package. Simply
call `library(assessr)` at the beginning of your script.

## Assessment Functions

This package contains functions to calculate [sales ratio study performance statistics](https://www.iaao.org/media/standards/Standard_on_Ratio_Studies.pdf). The settings of these functions are governed by CCAO Data Science Department SOPs. Do not change them without asking.

### Example Usage

These functions can be used to calculate the COD, PRD, or PRB of a set of ratios. 

```{r, warning=FALSE, message=FALSE}
library(assessr)
library(dplyr)

data("ratios_sample")

# Calculate COD
cod_func(ratios_sample$ratios, bootstrap_n = 1000)

# Calculate PRB
prb_func(
  ratios_sample$ratios,
  ratios_sample$assessed_values,
  ratios_sample$sales
)

```

They can also by applied by group. For example, to get each statistic by township.

```{r, warning=FALSE}
ratios_sample %>%
  group_by(town) %>%
  summarise(
    COD = cod_func(ratios, bootstrap_n = 1000)$COD,
    PRD = prd_func(ratios, sales, bootstrap_n = 1000)$PRD,
    PRB = prb_func(ratios, sales, assessed_values)$PRB
  )

```

You can even use `dplyr` witchcraft to calculate every stat for every group at the same time.

```{r}
ratios_sample %>%
  group_by(town) %>%
  group_modify(~ {
    bind_rows(
      cod_func(.x$ratios, bootstrap_n = 1000),
      prd_func(.x$ratios, .x$sales, bootstrap_n = 1000),
      prb_func(.x$ratios, .x$sales, .x$assessed_values)
    )
  }) %>%
  summarise_each(list(~ first(.x[!is.na(.x)]))) 

```

